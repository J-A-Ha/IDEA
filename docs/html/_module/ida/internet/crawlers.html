<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ida.internet.crawlers &mdash; IDA 0.01 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            IDA
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">ida</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">IDA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ida.internet.crawlers</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ida.internet.crawlers</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Functions for crawling web data&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">..core.basics</span> <span class="kn">import</span> <span class="n">map_inf_to_1</span><span class="p">,</span> <span class="n">map_inf_to_0</span>
<span class="kn">from</span> <span class="nn">..text.textanalysis</span> <span class="kn">import</span> <span class="n">cosine_sim</span>
<span class="kn">from</span> <span class="nn">.webanalysis</span> <span class="kn">import</span> <span class="n">correct_url</span><span class="p">,</span> <span class="n">get_domain</span><span class="p">,</span> <span class="n">is_domain</span><span class="p">,</span> <span class="n">domain_splitter</span><span class="p">,</span> <span class="n">is_registered_domain</span><span class="p">,</span> <span class="n">url_to_valid_attr_name</span>
<span class="kn">from</span> <span class="nn">.scrapers</span> <span class="kn">import</span> <span class="n">get_url_source</span><span class="p">,</span> <span class="n">scrape_url_html</span><span class="p">,</span> <span class="n">scrape_url_metadata</span><span class="p">,</span> <span class="n">scrape_url_rawtext</span><span class="p">,</span> <span class="n">scrape_url_xml</span><span class="p">,</span> <span class="n">scrape_url_json</span><span class="p">,</span> <span class="n">scrape_url_csv</span><span class="p">,</span> <span class="n">scrape_url_to_dict</span><span class="p">,</span> <span class="n">scrape_url</span><span class="p">,</span> <span class="n">scrape_url_links</span><span class="p">,</span> <span class="n">scrape_dynamic_page</span><span class="p">,</span> <span class="n">scrape_google_search</span><span class="p">,</span> <span class="n">crawler_scraper</span>
<span class="kn">from</span> <span class="nn">.parsers</span> <span class="kn">import</span> <span class="n">parse_google_result</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">queue</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">Levenshtein</span> <span class="kn">import</span> <span class="n">distance</span> <span class="k">as</span> <span class="n">lev</span>

<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">from</span> <span class="nn">trafilatura</span> <span class="kn">import</span> <span class="n">fetch_url</span><span class="p">,</span> <span class="n">extract</span><span class="p">,</span> <span class="n">feeds</span><span class="p">,</span> <span class="n">sitemaps</span><span class="p">,</span> <span class="n">extract_metadata</span><span class="p">,</span> <span class="n">spider</span>
<span class="kn">from</span> <span class="nn">trafilatura.spider</span> <span class="kn">import</span> <span class="n">focused_crawler</span>

<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">robotparser</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span><span class="p">,</span> <span class="n">quote_plus</span><span class="p">,</span> <span class="n">urlparse</span>

<span class="kn">from</span> <span class="nn">courlan</span> <span class="kn">import</span> <span class="n">extract_domain</span><span class="p">,</span> <span class="n">normalize_url</span><span class="p">,</span> <span class="n">clean_url</span><span class="p">,</span> <span class="n">validate_url</span><span class="p">,</span> <span class="n">sample_urls</span><span class="p">,</span> <span class="n">check_url</span><span class="p">,</span> <span class="n">scrub_url</span><span class="p">,</span> <span class="n">is_external</span>

<span class="kn">from</span> <span class="nn">igraph</span> <span class="kn">import</span> <span class="n">Graph</span> <span class="k">as</span> <span class="n">Graph</span>


<div class="viewcode-block" id="is_external_link"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.is_external_link">[docs]</a><span class="k">def</span> <span class="nf">is_external_link</span><span class="p">(</span><span class="n">source_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">,</span> <span class="n">linked_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">,</span> <span class="n">ignore_suffix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if provided link directs to a URL which is external to a source&#39;s website.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    source_url : str</span>
<span class="sd">        URL to check. Defaults to requesting from user input.</span>
<span class="sd">    linked_url : str</span>
<span class="sd">        link to check. Defaults to requesting from user input.</span>
<span class="sd">    ignore_suffix : bool</span>
<span class="sd">        whether to ignore the site&#39;s suffix. Defaults to False.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : bool</span>
<span class="sd">        whether the link is internal or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Requesting source URL from user input if none given</span>
    <span class="k">if</span> <span class="n">source_url</span> <span class="o">==</span> <span class="s1">&#39;request_input&#39;</span><span class="p">:</span>
        <span class="n">source_url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Source URL: &#39;</span><span class="p">)</span>
        
    <span class="c1"># Requesting linked URL from user input if none given</span>
    <span class="k">if</span> <span class="n">linked_url</span> <span class="o">==</span> <span class="s1">&#39;request_input&#39;</span><span class="p">:</span>
        <span class="n">linked_url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Linked URL: &#39;</span><span class="p">)</span>
    
    <span class="c1"># Correcting URLs if needed (e.g., adding missing HTTPS prefix)</span>
    <span class="n">source_url</span> <span class="o">=</span> <span class="n">correct_url</span><span class="p">(</span><span class="n">source_url</span><span class="p">)</span>
    <span class="n">linked_url</span> <span class="o">=</span> <span class="n">correct_url</span><span class="p">(</span><span class="n">linked_url</span><span class="p">)</span>
    
    <span class="c1"># Checking if link is external</span>
    <span class="k">return</span> <span class="n">is_external</span><span class="p">(</span><span class="n">source_url</span><span class="p">,</span> <span class="n">linked_url</span><span class="p">,</span> <span class="n">ignore_suffix</span><span class="o">=</span><span class="n">ignore_suffix</span><span class="p">)</span></div>


<div class="viewcode-block" id="fetch_feed_urls"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.fetch_feed_urls">[docs]</a><span class="k">def</span> <span class="nf">fetch_feed_urls</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves URLs from web feed.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    url : str</span>
<span class="sd">        URL to fetch from. Defaults to requesting from user input.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : list</span>
<span class="sd">        web feed result as a list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Requesting source URL from user input if none given</span>
    <span class="k">if</span> <span class="n">url</span> <span class="o">==</span> <span class="s1">&#39;request_input&#39;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;URL: &#39;</span><span class="p">)</span>
    
    <span class="c1"># Correcting URL if needed (e.g., adding missing HTTPS prefix)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">correct_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="c1"># Retrieving URLs from feed</span>
    <span class="n">out_list</span> <span class="o">=</span> <span class="n">feeds</span><span class="o">.</span><span class="n">find_feed_urls</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">out_list</span></div>

<div class="viewcode-block" id="fetch_sitemap"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.fetch_sitemap">[docs]</a><span class="k">def</span> <span class="nf">fetch_sitemap</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves website sitemap. Returns a list of URLs in sitemap.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    url : str</span>
<span class="sd">        URL to fetch from. Defaults to requesting from user input.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : list</span>
<span class="sd">        sitemap as a list of URLs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Requesting source URL from user input if none given</span>
    <span class="k">if</span> <span class="n">url</span> <span class="o">==</span> <span class="s1">&#39;request_input&#39;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;URL: &#39;</span><span class="p">)</span>
    
    <span class="c1"># Correcting URL if needed (e.g., adding missing HTTPS prefix)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">correct_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="c1"># Fetching sitemap</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sitemaps</span><span class="o">.</span><span class="n">sitemap_search</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="fetch_url_rules"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.fetch_url_rules">[docs]</a><span class="k">def</span> <span class="nf">fetch_url_rules</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves website&#39;s rules for robots from robots.txt.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    url : str</span>
<span class="sd">        URL to fetch from. Defaults to requesting from user input.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : object</span>
<span class="sd">        Robots.txt ruleset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Requesting source URL from user input if none given</span>
    <span class="k">if</span> <span class="n">url</span> <span class="o">==</span> <span class="s1">&#39;request_input&#39;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;URL: &#39;</span><span class="p">)</span>
    
    <span class="c1"># Correcting URL if needed (e.g., adding missing HTTPS prefix)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">correct_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="c1"># Loading the necessary components; fetching and parsing the file</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="n">robotparser</span><span class="o">.</span><span class="n">RobotFileParser</span><span class="p">()</span>
    <span class="n">rules</span><span class="o">.</span><span class="n">set_url</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;/robots.txt&#39;</span><span class="p">)</span>
    <span class="n">rules</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">rules</span></div>

<div class="viewcode-block" id="check_crawl_permission"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.check_crawl_permission">[docs]</a><span class="k">def</span> <span class="nf">check_crawl_permission</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if web crawler has permission to crawl website.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    url : str</span>
<span class="sd">        URL to check. Defaults to requesting from user input.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : bool</span>
<span class="sd">        whether the URL allows for crawlers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Retrieving site&#39;s rules from robots.txt</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="n">fetch_url_rules</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">)</span>

    <span class="c1"># Determining if a page can be fetched by all crawlers</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">can_fetch</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;https://www.example.org/page1234.html&quot;</span><span class="p">)</span>
    <span class="c1"># returns True or False</span>
    
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="check_bad_url"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.check_bad_url">[docs]</a><span class="k">def</span> <span class="nf">check_bad_url</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if URL leads to a real website.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    url : str</span>
<span class="sd">        URL to check. Defaults to requesting from user input.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : bool</span>
<span class="sd">        whether the URL is a bad link (True == bad).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Requesting URL from user input if none given</span>
    <span class="k">if</span> <span class="n">url</span> <span class="o">==</span> <span class="s1">&#39;request_input&#39;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;URL: &#39;</span><span class="p">)</span>
    
    <span class="c1"># Correcting URL if needed (e.g., adding missing HTTPS prefix)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">correct_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="c1"># Trying to make request to URL. If this is successful, URL is not bad; returns False.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">except</span><span class="p">:</span>
        
        <span class="k">return</span> <span class="kc">True</span></div>
    

<div class="viewcode-block" id="append_domain"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.append_domain">[docs]</a><span class="k">def</span> <span class="nf">append_domain</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Appends domain to the start of a URL.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    url : str</span>
<span class="sd">        URL to append domain to</span>
<span class="sd">    domain : str</span>
<span class="sd">        domain to append.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : str</span>
<span class="sd">        the fixed URL.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Correcting URL if needed (e.g., adding missing HTTPS prefix)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">correct_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="c1"># Trying to make request to cleaned URL. If successful, no further action is necessary</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">url</span>
    
    <span class="c1"># If request fails, appending domain to start of URL and checking if this is now a good URL.</span>
    <span class="k">except</span><span class="p">:</span>
        
        <span class="n">url</span> <span class="o">=</span> <span class="n">domain</span> <span class="o">+</span> <span class="n">url</span>
        
        <span class="c1"># Checking if URL is bad</span>
        <span class="n">is_bad</span> <span class="o">=</span> <span class="n">check_bad_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        
        <span class="c1"># If not, append has been successful</span>
        <span class="k">if</span> <span class="n">is_bad</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">url</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;URL may not be a valid domain&#39;</span><span class="p">)</span></div>
        
        
        

<div class="viewcode-block" id="crawl_site"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.crawl_site">[docs]</a><span class="k">def</span> <span class="nf">crawl_site</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">,</span> <span class="n">max_seen_urls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">max_known_urls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crawls website&#39;s internal pages. Returns any links found as a list.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    url : str </span>
<span class="sd">        URL of the website to crawl.</span>
<span class="sd">    max_seen_urls : int </span>
<span class="sd">        the number of pages the crawler is allowed to see before stopping.</span>
<span class="sd">    max_known_urls : int </span>
<span class="sd">        the number of URLs the crawler is allowed to find before stopping.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : list </span>
<span class="sd">        a list of URLs found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Requesting URL from user input if none given</span>
    <span class="k">if</span> <span class="n">url</span> <span class="o">==</span> <span class="s1">&#39;request_input&#39;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;URL: &#39;</span><span class="p">)</span>
    
    <span class="c1"># Correcting URL if needed (e.g., adding missing HTTPS prefix)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">correct_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="c1"># Starting crawl</span>
    <span class="n">to_visit</span><span class="p">,</span> <span class="n">known_urls</span> <span class="o">=</span> <span class="n">focused_crawler</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">max_seen_urls</span><span class="o">=</span><span class="n">max_seen_urls</span><span class="p">,</span> <span class="n">max_known_urls</span><span class="o">=</span><span class="n">max_known_urls</span><span class="p">)</span>
    
    
    <span class="c1"># Formatting results</span>
    <span class="n">to_visit</span><span class="p">,</span> <span class="n">known_urls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_visit</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">known_urls</span><span class="p">)</span>
    <span class="n">visit_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">to_visit</span><span class="p">)</span>
    <span class="n">known_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">known_urls</span><span class="p">)</span>
    
    <span class="c1"># Combining set of URLs visited with URLs found</span>
    <span class="n">total_urls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">visit_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">known_set</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">total_urls</span></div>

<div class="viewcode-block" id="correct_link_errors"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.correct_link_errors">[docs]</a><span class="k">def</span> <span class="nf">correct_link_errors</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source_domain</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks for errors in a link and corrects them. Returns a corrected link as a string.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    url : str </span>
<span class="sd">        URL to correct.</span>
<span class="sd">    source_domain : str </span>
<span class="sd">        the domain or URL where the link was found.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    url : str </span>
<span class="sd">        a corrected URL.&quot;&quot;&quot;</span>
    
    <span class="c1"># Source domain defaults to None. Changing this to an empty string for type handling.</span>
    <span class="k">if</span> <span class="n">source_domain</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">source_domain</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    
    <span class="c1"># Ensuring source_domain is a domain, not a full URL</span>
    <span class="n">source_domain</span> <span class="o">=</span> <span class="n">get_domain</span><span class="p">(</span><span class="n">source_domain</span><span class="p">)</span>
    
    <span class="c1"># Checking if domain is valid and retrieving domain if so</span>
    <span class="n">domain_check</span> <span class="o">=</span> <span class="n">get_domain</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="c1"># If domain check fails</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">domain_check</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">domain_check</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">domain_check</span><span class="p">):</span>
        
        <span class="c1"># Checking if URL is bad. If true, cleaning URL</span>
        <span class="k">if</span> <span class="n">check_bad_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">clean_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">scrub_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            
            <span class="c1"># Checking if URL is still bad. If true, appending source domain to start of URL</span>
            <span class="k">if</span> <span class="n">check_bad_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">source_domain</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">url</span>
            
            <span class="c1"># Correcting URL if needed (e.g., adding missing HTTPS prefix)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">correct_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">url</span></div>



<div class="viewcode-block" id="correct_seed_errors"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.correct_seed_errors">[docs]</a><span class="k">def</span> <span class="nf">correct_seed_errors</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks for and corrects errors in a URL to be used as a crawler seed. Returns a corrected link as a string.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    url : str </span>
<span class="sd">        URL to correct.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    url : str </span>
<span class="sd">        a corrected URL.&quot;&quot;&quot;</span>
    
    <span class="c1"># Checking for URL&#39;s domain</span>
    <span class="n">domain_check</span> <span class="o">=</span> <span class="n">get_domain</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="c1"># Proceeding if domain check fails </span>
    <span class="k">if</span> <span class="p">(</span><span class="n">domain_check</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">domain_check</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">domain_check</span><span class="p">):</span>
        
        <span class="c1"># Proceeding if URL is a bad link </span>
        <span class="k">if</span> <span class="n">check_bad_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            
            <span class="c1"># If URL is bad, applying corrections</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">clean_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">scrub_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">correct_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">url</span></div>

<div class="viewcode-block" id="select_crawled_links"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.select_crawled_links">[docs]</a><span class="k">def</span> <span class="nf">select_crawled_links</span><span class="p">(</span>
                        <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                         <span class="n">source_domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                         <span class="n">link_elements</span><span class="p">,</span> 
                         <span class="n">urls</span><span class="p">:</span> <span class="n">queue</span><span class="p">,</span> 
                         <span class="n">visited_urls</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> 
                         <span class="n">ignore_urls</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> 
                         <span class="n">ignore_domains</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                         <span class="n">excluded_url_terms</span><span class="p">:</span> <span class="nb">list</span>
                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selects links to crawl from set of crawler scraper results. To be used by web crawler. Returns a tuple containing links and URLs.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    iteration : int </span>
<span class="sd">        how many iterations the crawler engine has run.</span>
<span class="sd">    source_domain : str </span>
<span class="sd">        domain of URL currently being crawled.</span>
<span class="sd">    link_elements : list</span>
<span class="sd">        iterable containing URL&#39;s links as HTML elements.</span>
<span class="sd">    urls : queue </span>
<span class="sd">        ordered queue of URLs to be crawled.</span>
<span class="sd">    visited_urls : list </span>
<span class="sd">        list of URLs already visited.</span>
<span class="sd">    ignore_urls : list </span>
<span class="sd">        list of URLs to ignore.</span>
<span class="sd">    ignore_domains : </span>
<span class="sd">        list list of domains to ignore.</span>
<span class="sd">    excluded_url_terms : list </span>
<span class="sd">        list of strings; link will be ignored if it contains any string in list.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : tuple </span>
<span class="sd">        a tuple containing the updated URLs queue and any new links found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Initialising links list</span>
    <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Iterating through link lements to extract links</span>
    <span class="k">for</span> <span class="n">link_element</span> <span class="ow">in</span> <span class="n">link_elements</span><span class="p">:</span>
        
        <span class="c1"># Cleaning link elements</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">link_element</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">correct_link_errors</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span> <span class="n">source_domain</span> <span class="o">=</span> <span class="n">source_domain</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">get_domain</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="c1"># Appending link to list of links found</span>
        <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        
        <span class="c1"># Checking if the URL does not include an excluded term</span>
        <span class="n">exclude_test</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">excluded_url_terms</span><span class="p">:</span>
            <span class="n">term</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">url_check</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                
            <span class="k">if</span> <span class="p">(</span><span class="n">term</span> <span class="ow">in</span> <span class="n">url_check</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">exclude_test</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1"># If the URL does not an excluded term, selects link to be added to queue</span>
        <span class="k">if</span> <span class="n">exclude_test</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
            
            <span class="c1"># Proceeds if the URL is not included in the ignore list</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">url</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> 
                <span class="ow">and</span> <span class="p">(</span><span class="n">url</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_urls</span><span class="p">)</span> 
                <span class="ow">and</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">domain</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> 
                    <span class="ow">and</span> <span class="p">(</span><span class="n">domain</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_domains</span><span class="p">)</span>
                    <span class="p">)</span>

            <span class="p">):</span>
                <span class="c1"># Creating variations on URL to check if already visited</span>
                <span class="n">no_http</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;https://&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">www_added</span> <span class="o">=</span> <span class="s1">&#39;www.&#39;</span><span class="o">+</span> <span class="n">no_http</span>
                <span class="n">www_https_added</span> <span class="o">=</span> <span class="s1">&#39;https://&#39;</span> <span class="o">+</span> <span class="n">www_added</span>
                <span class="n">www_removed</span> <span class="o">=</span> <span class="n">no_http</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;www&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">www_removed_https_added</span> <span class="o">=</span> <span class="s1">&#39;https://&#39;</span> <span class="o">+</span> <span class="n">www_removed</span>
                
                <span class="c1"># Proceeds if URL or a variation on it has not been visited already</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">url</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited_urls</span><span class="p">)</span> 
                    <span class="ow">and</span> <span class="p">(</span><span class="n">no_http</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited_urls</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">www_added</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited_urls</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">www_https_added</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited_urls</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">www_removed</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited_urls</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">www_removed_https_added</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited_urls</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">url</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">urls</span><span class="o">.</span><span class="n">queue</span><span class="p">])</span>
                <span class="p">):</span>
                    
                    <span class="c1"># Setting default priority score as the current crawler&#39;s iteration number. </span>
                    <span class="c1"># This queues them in order of crawl depth.</span>
                    <span class="n">priority_score</span> <span class="o">=</span> <span class="n">iteration</span>
                    
                    <span class="c1"># Incrementing priority score to queue links in order of discovery.</span>
                    <span class="c1"># Increment is very small to ensure </span>
                    <span class="c1"># that the depth-first ranking of discovered links is not overriden.</span>
                    <span class="n">priority_score</span> <span class="o">+=</span> <span class="mf">0.001</span>
                    
                    <span class="c1"># Prioritising shorter urls. Uses the normalised string length of the url, </span>
                    <span class="c1"># where length of 0 -&gt; 0 and an infinite length -&gt; 0.1</span>
                    
                    <span class="n">url_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                    <span class="n">normalised_len</span> <span class="o">=</span> <span class="n">map_inf_to_1</span><span class="p">(</span><span class="n">url_len</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
                    <span class="n">priority_score</span> <span class="o">+=</span> <span class="n">normalised_len</span>
                    
                    <span class="c1"># Adding link to URLs queue with assigned priority score</span>
                    <span class="n">urls</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">priority_score</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span></div>

<div class="viewcode-block" id="excluded_term_test"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.excluded_term_test">[docs]</a><span class="k">def</span> <span class="nf">excluded_term_test</span><span class="p">(</span><span class="n">current_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">excluded_url_terms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if URL contains terms to be excluded. To be used by web crawler.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    current_url : str </span>
<span class="sd">        link to check.</span>
<span class="sd">    excluded_url_terms : list </span>
<span class="sd">        list of strings to check for.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether to be case sensitive when checking for terms.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : bool </span>
<span class="sd">        True if the URL contains a term in excluded_url_terms list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Initialising output variable; defaulting to False</span>
    <span class="n">excluded_term_test</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="c1"># Iterating through excluded terms to check in URL</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">excluded_url_terms</span><span class="p">:</span>
            
            <span class="c1"># If instructed to not be case sensitive, turning all strings to lowercase</span>
            <span class="k">if</span> <span class="n">case_sensitive</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">term</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">url_check</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_url</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            
            <span class="c1"># Returning True if term is found</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">term</span> <span class="ow">in</span> <span class="n">url_check</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span></div>
        

<div class="viewcode-block" id="required_keywords_test"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.required_keywords_test">[docs]</a><span class="k">def</span> <span class="nf">required_keywords_test</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">required_keywords</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if text contains a set of required keywords. Returns True if it does. To be used by web crawler.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    text : str </span>
<span class="sd">        text to check.</span>
<span class="sd">    required_keywords : list </span>
<span class="sd">        list of strings to check for.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether to be case sensitive when checking for terms.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : bool </span>
<span class="sd">        True if the text contains a term in required_keywords list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Initialising output variable; defaulting to True</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1"># Iterating through required terms to check in text</span>
    <span class="k">for</span> <span class="n">required_word</span> <span class="ow">in</span> <span class="n">required_keywords</span><span class="p">:</span>
            
            <span class="c1"># Checking for None types; changing to empty string to avoid errors</span>
            <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            
            <span class="c1"># If instructed to not be case sensitive, turning all strings to lowercase</span>
            <span class="k">if</span> <span class="n">case_sensitive</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">required_word</span> <span class="o">=</span> <span class="n">required_word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            
            <span class="c1"># Returning False if term is *not* found</span>
            <span class="k">if</span> <span class="n">required_word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="excluded_keywords_test"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.excluded_keywords_test">[docs]</a><span class="k">def</span> <span class="nf">excluded_keywords_test</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">excluded_keywords</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if text contains a set of excluded keywords. Returns True if it does not. To be used by web crawler.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    text : str </span>
<span class="sd">        text to check.</span>
<span class="sd">    excluded_keywords : list </span>
<span class="sd">        list of strings to check for.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether to be case sensitive when checking for terms.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : bool </span>
<span class="sd">        True if the text contains a term in excluded_keywords list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Initialising output variable; defaulting to True</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1"># Iterating through excluded terms to check in text</span>
    <span class="k">for</span> <span class="n">excluded_word</span> <span class="ow">in</span> <span class="n">excluded_keywords</span><span class="p">:</span>
            
            <span class="c1"># Checking for None types; changing to empty string to avoid errors</span>
            <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            
            <span class="c1"># If instructed to not be case sensitive, turning all strings to lowercase</span>
            <span class="k">if</span> <span class="n">case_sensitive</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">excluded_word</span> <span class="o">=</span> <span class="n">excluded_word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            
            <span class="c1"># Returning False if term is found</span>
            <span class="k">if</span> <span class="n">excluded_word</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="crawler_engine"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.crawler_engine">[docs]</a><span class="k">def</span> <span class="nf">crawler_engine</span><span class="p">(</span>
                    <span class="n">urls</span><span class="p">,</span>
                    <span class="n">required_keywords</span><span class="p">,</span> 
                    <span class="n">excluded_keywords</span><span class="p">,</span>
                    <span class="n">excluded_url_terms</span><span class="p">,</span>
                    <span class="n">case_sensitive</span><span class="p">,</span>
                    <span class="n">visit_limit</span><span class="p">,</span> 
                    <span class="n">ignore_urls</span><span class="p">,</span> 
                    <span class="n">ignore_domains</span><span class="p">,</span>
                    <span class="n">be_polite</span><span class="p">,</span> 
                    <span class="n">full</span>
                <span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Core functionality for web crawler. Takes inputted URLs, scrapes them, and returns a dictionary of results.</span>
<span class="sd">    </span>
<span class="sd">    Iterates through queue of URLS; runs checks to see if should proceed with scraping; </span>
<span class="sd">    if so, scrapes them and adds links found to queue.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    urls : queue </span>
<span class="sd">        ordered queue of URLs to be crawled.</span>
<span class="sd">    required_keywords : list </span>
<span class="sd">        list of keywords which sites must contain to be crawled.</span>
<span class="sd">    excluded_keywords : list </span>
<span class="sd">        list of keywords which sites must *not* contain to be crawled.</span>
<span class="sd">    excluded_url_terms : list </span>
<span class="sd">        list of strings; link will be ignored if it contains any string in list.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether or not to ignore string characters&#39; case.</span>
<span class="sd">    visit_limit : int </span>
<span class="sd">        how many URLs the crawler should visit before it stops.</span>
<span class="sd">    ignore_urls : list </span>
<span class="sd">        list of URLs to ignore.</span>
<span class="sd">    ignore_domains : list </span>
<span class="sd">        list of domains to ignore.</span>
<span class="sd">    be_polite : bool </span>
<span class="sd">        whether to respect websites&#39; permissions for crawlers.</span>
<span class="sd">    full : bool </span>
<span class="sd">        whether to run a full scrape on each site. This takes longer.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    output_dict : dict </span>
<span class="sd">        a dictionary containing results from each crawled site.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Intiailising variables to store the pages already visited</span>
    <span class="n">visited_urls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1"># until all pages have been visited</span>
    
    <span class="k">while</span> <span class="ow">not</span> <span class="n">urls</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
        
        <span class="c1"># Checking if crawler has visited the maximum number of URls. If so, halts.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">visited_urls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">visit_limit</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Limit reached&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        
        <span class="c1"># Getting the URL to visit from the queue</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">current_url</span> <span class="o">=</span> <span class="n">urls</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        
        <span class="c1"># Cleaning URL</span>
        <span class="n">current_url</span> <span class="o">=</span> <span class="n">current_url</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="c1"># Checking if URL has been visited. If True, skips.</span>
        <span class="k">if</span> <span class="n">current_url</span> <span class="ow">in</span> <span class="n">visited_urls</span><span class="p">:</span>
            <span class="k">continue</span>
        
        <span class="c1"># Checking if URL includes an excluded term. If True, skips URL</span>
        <span class="k">if</span> <span class="n">excluded_term_test</span><span class="p">(</span><span class="n">current_url</span><span class="p">,</span> <span class="n">excluded_url_terms</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">continue</span>
        
        <span class="c1"># Checking if URL is bad. If True, tries to correct it.</span>
        <span class="k">if</span> <span class="n">check_bad_url</span><span class="p">(</span><span class="s1">&#39;current_url&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">current_url</span> <span class="o">=</span> <span class="n">correct_seed_errors</span><span class="p">(</span><span class="n">current_url</span><span class="p">)</span>
        
        <span class="c1"># If be_polite is True, checks if crawler has permission to crawl/scrape URL</span>
        <span class="k">if</span> <span class="n">be_polite</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># If the crawler does not have permission, skips URL</span>
                <span class="k">if</span> <span class="n">check_crawl_permission</span><span class="p">(</span><span class="n">current_url</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        
        <span class="c1"># Initialising result variable</span>
        <span class="n">crawl_res</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1"># Trying to scrape URL</span>
        <span class="k">try</span><span class="p">:</span>
            
            <span class="c1"># Scraping URL and retrieving links</span>
            <span class="n">crawl_res</span> <span class="o">=</span> <span class="n">crawler_scraper</span><span class="p">(</span><span class="n">current_url</span><span class="p">,</span> <span class="n">full</span><span class="p">)</span>
            <span class="n">scraped_links</span> <span class="o">=</span> <span class="n">crawl_res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="c1"># Appending results to result dictionary</span>
            <span class="n">output_dict</span><span class="p">[</span><span class="n">current_url</span><span class="p">]</span> <span class="o">=</span> <span class="n">crawl_res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1"># Retrieving domain</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">get_domain</span><span class="p">(</span><span class="n">current_url</span><span class="p">)</span>
        
        <span class="c1"># If scrape fails, sets current_url to None</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># Appending results to result dictionary</span>
            <span class="n">output_dict</span><span class="p">[</span><span class="n">current_url</span><span class="p">]</span> <span class="o">=</span> <span class="n">crawl_res</span>
            <span class="k">continue</span>
        
        <span class="c1"># Extracting raw text from site scrape result</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">crawl_res</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">crawl_res</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;raw_text&#39;</span><span class="p">]</span>
        
        <span class="k">elif</span> <span class="n">crawl_res</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        
        <span class="k">if</span> <span class="p">(</span>
            <span class="c1"># Skips if the scraped data does not contain required keywords</span>
            <span class="p">(</span><span class="n">required_keywords_test</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">required_keywords</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> 
            <span class="c1"># Skips if the scraped data contains excluded keywords</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">excluded_keywords_test</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">excluded_keywords</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">continue</span>
        
        <span class="c1"># Adding current URL to list of URLs already visited</span>
        <span class="n">visited_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_url</span><span class="p">)</span>
        
        <span class="c1"># Incrementing iteration count</span>
        <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># Selecting links to crawl from URL scrape result</span>
        <span class="n">links_res</span> <span class="o">=</span> <span class="n">select_crawled_links</span><span class="p">(</span>
                            <span class="n">iteration</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">,</span>
                            <span class="n">source_domain</span> <span class="o">=</span> <span class="n">domain</span><span class="p">,</span>
                            <span class="n">link_elements</span> <span class="o">=</span> <span class="n">scraped_links</span><span class="p">,</span> 
                            <span class="n">urls</span> <span class="o">=</span> <span class="n">urls</span><span class="p">,</span> 
                            <span class="n">visited_urls</span> <span class="o">=</span> <span class="n">visited_urls</span><span class="p">,</span>
                            <span class="n">ignore_urls</span> <span class="o">=</span> <span class="n">ignore_urls</span><span class="p">,</span> 
                            <span class="n">ignore_domains</span> <span class="o">=</span> <span class="n">ignore_domains</span><span class="p">,</span>
                            <span class="n">excluded_url_terms</span> <span class="o">=</span> <span class="n">excluded_url_terms</span>
                            <span class="p">)</span>
            
        <span class="n">urls</span> <span class="o">=</span> <span class="n">links_res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">current_links</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">links_res</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        
        <span class="c1"># Appending results to result dictionary</span>
        <span class="n">output_dict</span><span class="p">[</span><span class="n">current_url</span><span class="p">][</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain</span>
        <span class="n">output_dict</span><span class="p">[</span><span class="n">current_url</span><span class="p">][</span><span class="s1">&#39;links&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_links</span>
        
        <span class="c1"># Pausing crawler for a random interval to reduce server loads and avoid being blocked</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> 
        
        <span class="c1"># Displaying status to user</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Site visited: </span><span class="si">{</span><span class="n">current_url</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Visited count: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">visited_urls</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_dict</span></div>

<div class="viewcode-block" id="seed_str_to_list"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.seed_str_to_list">[docs]</a><span class="k">def</span> <span class="nf">seed_str_to_list</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a string of seed URLs in list format and returns a list object. To be used by web crawler.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    seed_urls : str </span>
<span class="sd">        string containing seed URLs.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    seed_urls : list </span>
<span class="sd">        List of seed urls.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">obj_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">)</span>
    
    <span class="c1"># Checking type. If list, no action taken</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">obj_type</span> <span class="o">==</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">obj_type</span> <span class="o">==</span> <span class="nb">set</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">obj_type</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">seed_urls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">)</span>
    
    <span class="c1"># If string, cleaning data and splitting into list</span>
    <span class="k">elif</span> <span class="n">obj_type</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        
        <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">seed_urls</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span> <span class="ow">in</span> <span class="n">seed_urls</span><span class="p">):</span>
            <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">seed_urls</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">seed_urls</span><span class="p">):</span>
            <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">seed_urls</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;;&#39;</span> <span class="ow">in</span> <span class="n">seed_urls</span><span class="p">):</span>
            <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">seed_urls</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">seed_urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">seed_urls</span><span class="p">]</span>
    
    <span class="c1"># Raising an error if conversion has failed</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;seed_urls must be a string, list, set, or tuple, not </span><span class="si">{</span><span class="n">obj_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">seed_urls</span></div>

<div class="viewcode-block" id="clean_seed_urls"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.clean_seed_urls">[docs]</a><span class="k">def</span> <span class="nf">clean_seed_urls</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cleans list of seed URLs. To be used by web crawler.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    seed_urls : list </span>
<span class="sd">        list containing seed URLs.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    seed_urls : list </span>
<span class="sd">        List of cleaned seed urls.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># If input is string, set, or tuple, converting to list</span>
    <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">seed_str_to_list</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">)</span>
    
    <span class="c1"># Initialising output variable</span>
    <span class="n">cleaned_seeds</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Iterating through seeds and cleaning</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">seed_urls</span><span class="p">:</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="n">correct_seed_errors</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="n">correct_url</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">cleaned_seeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">cleaned_seeds</span></div>


<div class="viewcode-block" id="crawler"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.crawler">[docs]</a><span class="k">def</span> <span class="nf">crawler</span><span class="p">(</span>
            <span class="n">seed_urls</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">,</span>
            <span class="n">visit_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
            <span class="n">excluded_url_terms</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
            <span class="n">required_keywords</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">excluded_keywords</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ignore_urls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">ignore_domains</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
            <span class="n">be_polite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">output_as</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;dataframe&#39;</span>
            <span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    General purpose web crawler. Crawls from a single URL or list of URLs.</span>
<span class="sd">    </span>
<span class="sd">    The crawler iterates through queue of URLS; runs checks to see if should proceed with scraping; </span>
<span class="sd">    if so, scrapes them and adds links found to queue.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    seed_urls : str or list </span>
<span class="sd">        one or more URLs from which to crawl.</span>
<span class="sd">    visit_limit : int </span>
<span class="sd">        how many URLs the crawler should visit before it stops.</span>
<span class="sd">    excluded_url_terms : list </span>
<span class="sd">        list of strings; link will be ignored if it contains any string in list.</span>
<span class="sd">    required_keywords : list </span>
<span class="sd">        list of keywords which sites must contain to be crawled.</span>
<span class="sd">    excluded_keywords : list </span>
<span class="sd">        list of keywords which sites must *not* contain to be crawled.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether or not to ignore string characters&#39; case.</span>
<span class="sd">    ignore_urls : list </span>
<span class="sd">        list of URLs to ignore.</span>
<span class="sd">    ignore_domains : list </span>
<span class="sd">        list of domains to ignore.</span>
<span class="sd">    be_polite : bool </span>
<span class="sd">        whether respect websites&#39; permissions for crawlers.</span>
<span class="sd">    full : bool </span>
<span class="sd">        whether to run a full scrape on each site. This takes longer.</span>
<span class="sd">    output_as : str </span>
<span class="sd">        the format to output results in. Defaults to a pandas.DataFrame.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : object </span>
<span class="sd">        an object containing the results of a crawl.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># See https://www.zenrows.com/blog/web-crawler-python#transitioning-to-a-real-world-web-crawler</span>

    <span class="c1"># Requesting seed URLS from user input if none provided</span>
    <span class="k">if</span> <span class="n">seed_urls</span> <span class="o">==</span> <span class="s1">&#39;request_input&#39;</span><span class="p">:</span>
        <span class="n">seed_urls</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Start from: &#39;</span><span class="p">)</span>
    
    <span class="c1"># If seed_urls are not in a Python list object, converting them to one</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">seed_str_to_list</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">)</span>
    
    <span class="c1"># Cleaning seed URLs to avoid errors</span>
    <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">clean_seed_urls</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">)</span>
    
    <span class="c1"># If ignore_domains set to default, loads a preset list of domains to ignore</span>
    <span class="k">if</span> <span class="n">ignore_domains</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
        <span class="n">ignore_domains</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="s1">&#39;ad.doubleclick.net&#39;</span>
                        <span class="p">]</span>
    <span class="c1"># If no ignore_urls given, sets an empty list</span>
    <span class="k">if</span> <span class="n">ignore_urls</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ignore_urls</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># If excluded_url_terms set to default, loads a preset terms of domains to exclude</span>
    <span class="k">if</span> <span class="n">excluded_url_terms</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
        <span class="n">excluded_url_terms</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="s1">&#39;advertise&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;doubleclick&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;advertising&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;cloudflare&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;holidays&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;app.&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;ctdonate&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;sitemap&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;jobs.&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;policies.google&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;adsense&#39;</span>
                            <span class="p">]</span>
        
    <span class="c1"># If no required_keywords given, sets an empty list</span>
    <span class="k">if</span> <span class="n">required_keywords</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">required_keywords</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># If no excluded_keywords given, sets an empty list</span>
    <span class="k">if</span> <span class="n">excluded_keywords</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">excluded_keywords</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Storing the URLs discovered to visit in a specific order</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">PriorityQueue</span><span class="p">()</span>
    
    <span class="c1"># Queing seeds with highest priority</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">seed_urls</span><span class="p">:</span>
        <span class="n">urls</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">seed</span><span class="p">))</span>
    
    <span class="c1"># Running crawler engine</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">crawler_engine</span><span class="p">(</span>
                    <span class="n">urls</span> <span class="o">=</span> <span class="n">urls</span><span class="p">,</span>
                    <span class="n">visit_limit</span> <span class="o">=</span> <span class="n">visit_limit</span><span class="p">,</span> 
                    <span class="n">excluded_url_terms</span> <span class="o">=</span> <span class="n">excluded_url_terms</span><span class="p">,</span>
                    <span class="n">required_keywords</span> <span class="o">=</span> <span class="n">required_keywords</span><span class="p">,</span> 
                    <span class="n">excluded_keywords</span> <span class="o">=</span> <span class="n">excluded_keywords</span><span class="p">,</span> 
                    <span class="n">case_sensitive</span> <span class="o">=</span> <span class="n">case_sensitive</span><span class="p">,</span>
                    <span class="n">ignore_urls</span> <span class="o">=</span> <span class="n">ignore_urls</span><span class="p">,</span> 
                    <span class="n">ignore_domains</span> <span class="o">=</span> <span class="n">ignore_domains</span><span class="p">,</span>
                    <span class="n">be_polite</span> <span class="o">=</span> <span class="n">be_polite</span><span class="p">,</span>
                    <span class="n">full</span> <span class="o">=</span> <span class="n">full</span>
                    <span class="p">)</span>
    
    <span class="c1"># Printing end status for user</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">----------------------</span><span class="se">\n</span><span class="s1">Crawl complete</span><span class="se">\n</span><span class="s1">----------------------&#39;</span><span class="p">)</span>
    
    <span class="c1"># If result is to be outputted as a dataframe, converting results dictionary to pandas.DataFrame</span>
    <span class="k">if</span> <span class="n">output_as</span> <span class="o">==</span> <span class="s1">&#39;dataframe&#39;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">!=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]):</span>
        
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;URL&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;date&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
        
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;author&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;hostname&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;date&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;fingerprint&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;id&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;license&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;comments&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;raw_text&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;language&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;image&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;pagetype&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;source&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;source-hostname&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;excerpt&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;categories&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;tags&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;html&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;url&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;description&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;sitename&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;body&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;commentsbody&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;links&#39;</span>
                                        <span class="p">]</span>
                                     <span class="p">)</span>
        
        <span class="c1"># Formatting dataframe</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">notnull</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">df</span>
    
    <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="crawl_web"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.crawl_web">[docs]</a><span class="k">def</span> <span class="nf">crawl_web</span><span class="p">(</span>
            <span class="n">seed_urls</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">,</span>
            <span class="n">visit_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
            <span class="n">excluded_url_terms</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
            <span class="n">required_keywords</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">excluded_keywords</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ignore_urls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">ignore_domains</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
            <span class="n">be_polite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">output_as</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;dataframe&#39;</span>
            <span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crawls internet from a single URL or list of URLs. Returns details like links found,  HTML scraped, and site metadata.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    seed_urls : str or list </span>
<span class="sd">        one or more URLs from which to crawl.</span>
<span class="sd">    visit_limit : int </span>
<span class="sd">        how many URLs the crawler should visit before it stops.</span>
<span class="sd">    excluded_url_terms : list </span>
<span class="sd">        list of strings; link will be ignored if it contains any string in list.</span>
<span class="sd">    required_keywords : list </span>
<span class="sd">        list of keywords which sites must contain to be crawled.</span>
<span class="sd">    excluded_keywords : list </span>
<span class="sd">        list of keywords which sites must *not* contain to be crawled.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether or not to ignore string characters&#39; case.</span>
<span class="sd">    ignore_urls : list </span>
<span class="sd">        list of URLs to ignore.</span>
<span class="sd">    ignore_domains : list </span>
<span class="sd">        list of domains to ignore.</span>
<span class="sd">    be_polite : bool </span>
<span class="sd">        whether respect websites&#39; permissions for crawlers.</span>
<span class="sd">    full : bool </span>
<span class="sd">        whether to run a full scrape on each site. This takes longer.</span>
<span class="sd">    output_as : str </span>
<span class="sd">        the format to output results in. Defaults to a pandas.DataFrame.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : object </span>
<span class="sd">        an object containing the results of a crawl.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    
    <span class="k">return</span> <span class="n">crawler</span><span class="p">(</span>
                    <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">seed_urls</span><span class="p">,</span>
                    <span class="n">visit_limit</span> <span class="o">=</span> <span class="n">visit_limit</span><span class="p">,</span> 
                    <span class="n">excluded_url_terms</span> <span class="o">=</span> <span class="n">excluded_url_terms</span><span class="p">,</span>
                    <span class="n">required_keywords</span> <span class="o">=</span> <span class="n">required_keywords</span><span class="p">,</span> 
                    <span class="n">excluded_keywords</span> <span class="o">=</span> <span class="n">excluded_keywords</span><span class="p">,</span> 
                    <span class="n">case_sensitive</span> <span class="o">=</span> <span class="n">case_sensitive</span><span class="p">,</span>
                    <span class="n">ignore_urls</span> <span class="o">=</span> <span class="n">ignore_urls</span><span class="p">,</span> 
                    <span class="n">ignore_domains</span> <span class="o">=</span> <span class="n">ignore_domains</span><span class="p">,</span>
                    <span class="n">be_polite</span> <span class="o">=</span> <span class="n">be_polite</span><span class="p">,</span>
                    <span class="n">full</span> <span class="o">=</span> <span class="n">full</span><span class="p">,</span>
                    <span class="n">output_as</span> <span class="o">=</span> <span class="n">output_as</span>
                    <span class="p">)</span></div>

<div class="viewcode-block" id="crawl_from_search"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.crawl_from_search">[docs]</a><span class="k">def</span> <span class="nf">crawl_from_search</span><span class="p">(</span>
            <span class="n">query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">,</span>
            <span class="n">visit_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
            <span class="n">excluded_url_terms</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
            <span class="n">required_keywords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">excluded_keywords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ignore_urls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">ignore_domains</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
            <span class="n">be_polite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">output_as</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;dataframe&#39;</span>
            <span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crawls internet from a web search.</span>
<span class="sd">    </span>
<span class="sd">    Returns details like links found,  HTML scraped, and site metadata.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    query : str </span>
<span class="sd">        query to search.</span>
<span class="sd">    visit_limit : int </span>
<span class="sd">        how many URLs the crawler should visit before it stops.</span>
<span class="sd">    excluded_url_terms : list </span>
<span class="sd">        list of strings; link will be ignored if it contains any string in list.</span>
<span class="sd">    required_keywords : list </span>
<span class="sd">        list of keywords which sites must contain to be crawled.</span>
<span class="sd">    excluded_keywords : list </span>
<span class="sd">        list of keywords which sites must *not* contain to be crawled.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether or not to ignore string characters&#39; case.</span>
<span class="sd">    ignore_urls : list </span>
<span class="sd">        list of URLs to ignore.</span>
<span class="sd">    ignore_domains : list </span>
<span class="sd">        list of domains to ignore.</span>
<span class="sd">    be_polite : bool </span>
<span class="sd">        whether respect websites&#39; permissions for crawlers.</span>
<span class="sd">    full : bool </span>
<span class="sd">        whether to run a full scrape on each site. This takes longer.</span>
<span class="sd">    output_as : str </span>
<span class="sd">        the format to output results in. Defaults to a pandas.DataFrame.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    result : object </span>
<span class="sd">        an object containing the results of a crawl.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Launching web search and retrieving results</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">scrape_google_search</span><span class="p">(</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">)</span>
    
    <span class="c1"># Initialising seed list for crawler</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;URL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    
    <span class="c1"># Running web crawler</span>
    <span class="k">return</span> <span class="n">crawler</span><span class="p">(</span>
                    <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">urls</span><span class="p">,</span>
                    <span class="n">visit_limit</span> <span class="o">=</span> <span class="n">visit_limit</span><span class="p">,</span> 
                    <span class="n">excluded_url_terms</span> <span class="o">=</span> <span class="n">excluded_url_terms</span><span class="p">,</span>
                    <span class="n">required_keywords</span> <span class="o">=</span> <span class="n">required_keywords</span><span class="p">,</span> 
                    <span class="n">excluded_keywords</span> <span class="o">=</span> <span class="n">excluded_keywords</span><span class="p">,</span> 
                    <span class="n">case_sensitive</span> <span class="o">=</span> <span class="n">case_sensitive</span><span class="p">,</span>
                    <span class="n">ignore_urls</span> <span class="o">=</span> <span class="n">ignore_urls</span><span class="p">,</span> 
                    <span class="n">ignore_domains</span> <span class="o">=</span> <span class="n">ignore_domains</span><span class="p">,</span>
                    <span class="n">be_polite</span> <span class="o">=</span> <span class="n">be_polite</span><span class="p">,</span>
                    <span class="n">full</span> <span class="o">=</span> <span class="n">full</span><span class="p">,</span>
                    <span class="n">output_as</span> <span class="o">=</span> <span class="n">output_as</span>
                    <span class="p">)</span></div>


<div class="viewcode-block" id="network_from_crawl_result"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.network_from_crawl_result">[docs]</a><span class="k">def</span> <span class="nf">network_from_crawl_result</span><span class="p">(</span><span class="n">crawl_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Graph</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes web crawler output and returns a network object.</span>
<span class="sd">    </span>
<span class="sd">    Crawled URLs become vertices; links between URLS become directed edges.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    crawl_df : pandas.DataFrame </span>
<span class="sd">        web crawler output to be converted to network.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    network : igraph.Graph </span>
<span class="sd">        a network representing the results of a web crawl.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Retrieving list of links</span>
    <span class="n">links_list</span> <span class="o">=</span> <span class="n">crawl_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    
    <span class="c1"># Counting links</span>
    <span class="n">links_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">links_list</span><span class="p">)</span>
    
    <span class="c1"># Initialising network object</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">links_n</span><span class="p">,</span> 
                    <span class="n">directed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                    <span class="n">vertex_attrs</span> <span class="o">=</span> <span class="p">{</span>
                                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">links_list</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;website&#39;</span>
                                    <span class="p">}</span>
                    <span class="p">)</span>
    
    <span class="c1"># Adding site data as vertices attributes</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">crawl_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">network</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">crawl_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    
    <span class="c1"># Adding edges by iterating through URLs (i.e. vertices)</span>
    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">vs</span><span class="p">:</span>
        
        <span class="c1"># Retrieving vertex index and name</span>
        <span class="n">source_index</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">index</span>
        <span class="n">source_name</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        
        <span class="c1"># Checking if vertex is in the original list of URls crawled</span>
        <span class="k">if</span> <span class="n">source_index</span> <span class="o">&gt;=</span> <span class="n">links_n</span><span class="p">:</span>
            
            <span class="c1"># If not in list, vertex will not link to other vertices </span>
            <span class="c1"># as no links will have been scraped</span>
            <span class="n">target_urls</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Retrieving scraped links</span>
            <span class="n">target_urls</span> <span class="o">=</span> <span class="n">crawl_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">source_name</span><span class="p">,</span> <span class="s1">&#39;links&#39;</span><span class="p">]</span>
            
            <span class="c1"># If the result is a string, transforms to list to avoid errors</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">target_urls</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">target_urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">target_urls</span><span class="p">]</span>
            
            <span class="c1"># If the result is None, transforms to empty list to list to avoid errors</span>
            <span class="k">if</span> <span class="n">target_urls</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">target_urls</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Iterating through each link to identify targets</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">target_urls</span><span class="p">:</span>
            
            <span class="c1"># If target URL not in network, adding vertex to network with URL as name</span>
            <span class="k">if</span> <span class="n">url</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                <span class="n">network</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">url</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;website&#39;</span><span class="p">)</span>
            
            <span class="c1"># Finding vertex index of target URL</span>
            <span class="n">target_index</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">url</span><span class="p">)</span>
            
            <span class="c1"># Adding edge between source vertex and target vertex</span>
            <span class="n">network</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> 
                           <span class="n">target_index</span><span class="p">,</span> 
                            <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;link&#39;</span>
                          <span class="p">)</span>
            
    <span class="k">return</span> <span class="n">network</span></div>

<div class="viewcode-block" id="network_from_crawl"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.network_from_crawl">[docs]</a><span class="k">def</span> <span class="nf">network_from_crawl</span><span class="p">(</span><span class="n">seed_urls</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">,</span>
                            <span class="n">visit_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
                            <span class="n">excluded_url_terms</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                            <span class="n">required_keywords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">excluded_keywords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">ignore_urls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">ignore_domains</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                            <span class="n">be_polite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">output_as</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;dataframe&#39;</span>
                            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Graph</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs web crawl from one or more seed URLS and generates a directed network from the results.</span>
<span class="sd">    </span>
<span class="sd">    Crawled URLs become vertices; links between URLS become directed edges.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    seed_urls : str or list </span>
<span class="sd">        one or more URLs from which to crawl.</span>
<span class="sd">    visit_limit : int </span>
<span class="sd">        how many URLs the crawler should visit before it stops.</span>
<span class="sd">    excluded_url_terms : list </span>
<span class="sd">        list of strings; link will be ignored if it contains any string in list.</span>
<span class="sd">    required_keywords : list </span>
<span class="sd">        list of keywords which sites must contain to be crawled.</span>
<span class="sd">    excluded_keywords : list </span>
<span class="sd">        list of keywords which sites must *not* contain to be crawled.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether or not to ignore string characters&#39; case.</span>
<span class="sd">    ignore_urls : list </span>
<span class="sd">        list of URLs to ignore.</span>
<span class="sd">    ignore_domains : list </span>
<span class="sd">        list of domains to ignore.</span>
<span class="sd">    be_polite : bool </span>
<span class="sd">        whether respect websites&#39; permissions for crawlers.</span>
<span class="sd">    full : bool </span>
<span class="sd">        whether to run a full scrape on each site. This takes longer.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    network : igraph.Graph </span>
<span class="sd">        a network representing the results of a web crawl.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">crawl_result</span> <span class="o">=</span> <span class="n">crawl_web</span><span class="p">(</span>
            <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">seed_urls</span><span class="p">,</span>
            <span class="n">visit_limit</span> <span class="o">=</span> <span class="n">visit_limit</span><span class="p">,</span> 
            <span class="n">excluded_url_terms</span> <span class="o">=</span> <span class="n">excluded_url_terms</span><span class="p">,</span>
            <span class="n">required_keywords</span> <span class="o">=</span> <span class="n">required_keywords</span><span class="p">,</span> 
            <span class="n">excluded_keywords</span> <span class="o">=</span> <span class="n">excluded_keywords</span><span class="p">,</span> 
            <span class="n">case_sensitive</span> <span class="o">=</span> <span class="n">case_sensitive</span><span class="p">,</span>
            <span class="n">ignore_urls</span> <span class="o">=</span> <span class="n">ignore_urls</span><span class="p">,</span> 
            <span class="n">ignore_domains</span> <span class="o">=</span> <span class="n">ignore_domains</span><span class="p">,</span>
            <span class="n">be_polite</span> <span class="o">=</span> <span class="n">be_polite</span><span class="p">,</span>
            <span class="n">full</span> <span class="o">=</span> <span class="n">full</span><span class="p">,</span>
            <span class="n">output_as</span> <span class="o">=</span> <span class="s1">&#39;dataframe&#39;</span>
            <span class="p">)</span>
    
    <span class="n">network</span> <span class="o">=</span> <span class="n">network_from_crawl_result</span><span class="p">(</span><span class="n">crawl_result</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">network</span></div>

<div class="viewcode-block" id="compare_sites"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.compare_sites">[docs]</a><span class="k">def</span> <span class="nf">compare_sites</span><span class="p">(</span><span class="n">crawl_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs comparative analysis on web crawler results.  Compares every combination of the sites provided. </span>
<span class="sd">    </span>
<span class="sd">    WARNING: can be slow if crawl is large.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    crawl_df : pandas.DataFrame </span>
<span class="sd">        web crawler output to be analysed.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    output_df : pandas.DataFrame </span>
<span class="sd">        dataframe of comparisons.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">        * title_distance : float Levenshtein distance between titles (0 if identical).</span>
<span class="sd">        * author_distance : float Levenshtein distance between author names (0 if identical).</span>
<span class="sd">        * hostname_distance : float Levenshtein distance between hostnames (0 if identical).</span>
<span class="sd">        * same_domain : bool whether sites share the same domain (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * shared_links : set links shared by both sites.</span>
<span class="sd">        * date_difference (timedelta): time difference between site date entries.</span>
<span class="sd">        * same_language : bool whether sites share the same language (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * fingerprint_distance : float Levenshtein distance between site fingerprints (0 if identical).</span>
<span class="sd">        * id_distance : float Levenshtein distance between site IDs (0 if identical).</span>
<span class="sd">        * license_distance : float Levenshtein distance between licenses (0 if identical).</span>
<span class="sd">        * comments_distance : float Levenshtein distance between comments (0 if identical).</span>
<span class="sd">        * raw_text_distance : float Levenshtein distance between raw texts (0 if identical).</span>
<span class="sd">        * raw_text_cosine : float Cosine similarity by word count of raw texts (1 if identical).</span>
<span class="sd">        * text_distance : float Levenshtein distance between parsed texts (0 if identical).</span>
<span class="sd">        * text_cosine : float Cosine similarity by word count of parsed texts (1 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source names (0 if identical).</span>
<span class="sd">        * source-hostname_distance : float Levenshtein distance between source-hostname names (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * excerpt_distance : float Levenshtein distance between excerpts (0 if identical).</span>
<span class="sd">        * excerpt_cosine : float Cosine similarity by word count of excerpts (1 if identical).</span>
<span class="sd">        * shared_categories : set category tags shared by both sites.</span>
<span class="sd">        * shared_tags : set tags shared by both sites.</span>
<span class="sd">        * html_distance : float Levenshtein distance between HTML source codes (0 if identical).</span>
<span class="sd">        * description_distance : float Levenshtein distance between descriptions (0 if identical).</span>
<span class="sd">        * description_cosine : float Cosine similarity by word count of descriptions (1 if identical).</span>
<span class="sd">        * sitename_distance : float Levenshtein distance between sitenames (0 if identical).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Retrieving list of URLs to compare</span>
    <span class="n">links_list</span> <span class="o">=</span> <span class="n">crawl_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    
    <span class="c1"># Initialising output dataframe</span>
    <span class="n">output_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">links_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;title_distance&#39;</span><span class="p">,</span>  <span class="c1"># Levenshtein distance (if not None)</span>
                 <span class="s1">&#39;author_distance&#39;</span><span class="p">,</span> <span class="c1"># Levenshtein distance (if not None)</span>
                 <span class="s1">&#39;hostname_distance&#39;</span><span class="p">,</span>  <span class="c1"># Levenshtein distance(if not None)</span>
                <span class="s1">&#39;same_domain&#39;</span><span class="p">,</span> <span class="c1"># True/False</span>
                 <span class="s1">&#39;domain_distance&#39;</span><span class="p">,</span> <span class="c1"># Levenshtein distance (if not None)</span>
                 <span class="s1">&#39;shared_links&#39;</span><span class="p">,</span> <span class="c1"># Set intersection</span>
                <span class="s1">&#39;shared_links_count&#39;</span><span class="p">,</span> <span class="c1"># Size of shared_links</span>
                 <span class="s1">&#39;date_difference&#39;</span><span class="p">,</span>  <span class="c1"># Time delta (if not None)</span>
                 <span class="s1">&#39;same_language&#39;</span><span class="p">,</span> <span class="c1"># True/False</span>
                 <span class="s1">&#39;fingerprint_distance&#39;</span><span class="p">,</span>  <span class="c1"># Levenshtein distance (if not None)</span>
                 <span class="s1">&#39;id_distance&#39;</span><span class="p">,</span>  <span class="c1"># Levenshtein distance (if not None)</span>
                 <span class="s1">&#39;license_distance&#39;</span><span class="p">,</span> <span class="c1"># Levenshtein distance (if not None)</span>
                 <span class="s1">&#39;comments_distance&#39;</span><span class="p">,</span> <span class="c1"># Levenshtein distance (if not None)</span>
                 <span class="s1">&#39;raw_text_distance&#39;</span><span class="p">,</span> <span class="c1"># Levenshtein distance (if not None)</span>
                <span class="s1">&#39;raw_text_cosine&#39;</span><span class="p">,</span> <span class="c1"># Cosine distance (if not None)</span>
                 <span class="s1">&#39;text_distance&#39;</span><span class="p">,</span> <span class="c1"># Levenshtein distance (if not None)</span>
                <span class="s1">&#39;text_cosine&#39;</span><span class="p">,</span>  <span class="c1"># Cosine distance (if not None)</span>
                 <span class="s1">&#39;source_distance&#39;</span><span class="p">,</span> <span class="c1"># Levenshtein distance (if not None)</span>
                 <span class="s1">&#39;source-hostname_distance&#39;</span><span class="p">,</span>  <span class="c1"># Levenshtein distance (if not None)</span>
                 <span class="s1">&#39;excerpt_distance&#39;</span><span class="p">,</span>  <span class="c1"># Levenshtein distance (if not None)</span>
                <span class="s1">&#39;excerpt_cosine&#39;</span><span class="p">,</span> <span class="c1"># Cosine distance (if not None)</span>
                 <span class="s1">&#39;shared_categories&#39;</span><span class="p">,</span> <span class="c1"># Set intersection</span>
                 <span class="s1">&#39;shared_tags&#39;</span><span class="p">,</span> <span class="c1"># Set intersection</span>
                 <span class="s1">&#39;html_distance&#39;</span><span class="p">,</span>   <span class="c1"># Levenshtein distance (if not None)</span>
                 <span class="s1">&#39;description_distance&#39;</span><span class="p">,</span>    <span class="c1"># Levenshtein distance (if not None)</span>
                <span class="s1">&#39;description_cosine&#39;</span><span class="p">,</span> <span class="c1"># Cosine distance (if not None)</span>
                 <span class="s1">&#39;sitename_distance&#39;</span>    <span class="c1"># Levenshtein distance (if not None)</span>
                <span class="p">]</span>
                            <span class="p">)</span>
    
    <span class="c1"># Iterating through columns</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">output_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        
        <span class="c1"># For columns requiring levenshtein distance, sets measure to &#39;lev&#39; and records source column</span>
        <span class="k">if</span> <span class="s1">&#39;_distance&#39;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
            <span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;lev&#39;</span>
            <span class="n">source_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_distance&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># For columns requiring cosine similarity, sets measure to &#39;cosine&#39; and records source column</span>
        <span class="k">if</span> <span class="s1">&#39;_cosine&#39;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
            <span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;cosine&#39;</span>
            <span class="n">source_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_cosine&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># For columns requiring set intersection, sets measure to &#39;intersection&#39; and records source column</span>
        <span class="k">if</span> <span class="s1">&#39;shared_&#39;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
            <span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;intersection&#39;</span>
            <span class="n">source_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;shared_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="c1"># If column is &#39;shared_links_count&#39;, sets measure to &#39;shared_links_count&#39; and records source column</span>
        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;shared_links_count&#39;</span><span class="p">:</span>
            <span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;shared_links_count&#39;</span>
            <span class="n">source_column</span> <span class="o">=</span> <span class="s1">&#39;links&#39;</span>
        
        <span class="c1"># If column is to check for identical data, sets measure to &#39;are_identical&#39; and records source column</span>
        <span class="k">if</span> <span class="s1">&#39;same_&#39;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
            <span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;are_identical&#39;</span>
            <span class="n">source_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;same_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="c1"># For columns requiring timedelta, sets measure to &#39;cosine&#39; and records source column</span>
        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;date_difference&#39;</span><span class="p">:</span>
            <span class="n">measure</span> <span class="o">=</span> <span class="s1">&#39;timedelta&#39;</span>
            <span class="n">source_column</span> <span class="o">=</span> <span class="s1">&#39;date&#39;</span>
        
        <span class="c1"># Ignores column names that are not in the dataframe</span>
        <span class="k">if</span> <span class="n">source_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">crawl_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">continue</span>
        
        <span class="c1"># Filling in output columns with required datatypes ahead of analysis</span>
        <span class="n">output_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">source_column</span>
        
        <span class="c1"># Iterating through URL combinations</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">output_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            
            <span class="c1"># Retrieving URLs from index tuple</span>
            <span class="n">url_1</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">url_2</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1"># Retrieving crawl results for URLs</span>
            <span class="n">url_1_data</span> <span class="o">=</span> <span class="n">crawl_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">url_1</span><span class="p">,</span> <span class="n">source_column</span><span class="p">]</span>
            <span class="n">url_2_data</span> <span class="o">=</span> <span class="n">crawl_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">url_2</span><span class="p">,</span> <span class="n">source_column</span><span class="p">]</span>
            
            <span class="c1"># Does not run analysis if either crawl result is None</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">url_1_data</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">url_2_data</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Running levenshtein distance analysis if required</span>
                <span class="k">if</span> <span class="n">measure</span> <span class="o">==</span> <span class="s1">&#39;lev&#39;</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">lev</span><span class="p">(</span><span class="n">url_1_data</span><span class="p">,</span> <span class="n">url_2_data</span><span class="p">)</span>
                    
                <span class="c1"># Running cosine similarity analysis if required</span>
                <span class="k">if</span> <span class="n">measure</span> <span class="o">==</span> <span class="s1">&#39;cosine&#39;</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">cosine_sim</span><span class="p">([</span><span class="n">url_1_data</span><span class="p">,</span> <span class="n">url_2_data</span><span class="p">])</span>
                
                <span class="c1"># Running set intersection analysis if required</span>
                <span class="k">if</span> <span class="n">measure</span> <span class="o">==</span> <span class="s1">&#39;intersection&#39;</span><span class="p">:</span>
                    <span class="n">set_1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">url_1_data</span><span class="p">)</span>
                    <span class="n">set_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">url_2_data</span><span class="p">)</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">set_1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">set_2</span><span class="p">)</span>
                
                <span class="c1"># Checking if data is identical if required</span>
                <span class="k">if</span> <span class="n">measure</span> <span class="o">==</span> <span class="s1">&#39;are_identical&#39;</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">url_1_data</span> <span class="o">==</span> <span class="n">url_2_data</span>
                
                <span class="c1"># Calculating time difference if required</span>
                <span class="k">if</span> <span class="n">measure</span> <span class="o">==</span> <span class="s1">&#39;timedelta&#39;</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">url_1_data</span> <span class="o">-</span> <span class="n">url_2_data</span><span class="p">)</span>
                
                <span class="c1"># Calculating size of set intersection if required</span>
                <span class="k">if</span> <span class="n">measure</span> <span class="o">==</span> <span class="s1">&#39;shared_links_count&#39;</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;shared_links&#39;</span><span class="p">])</span>
            
            <span class="c1"># Appending result to output dataframe</span>
            <span class="n">output_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
                

    <span class="k">return</span> <span class="n">output_df</span></div>

<div class="viewcode-block" id="site_similarities_from_crawl"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.site_similarities_from_crawl">[docs]</a><span class="k">def</span> <span class="nf">site_similarities_from_crawl</span><span class="p">(</span>
                                    <span class="n">seed_urls</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">,</span>
                                    <span class="n">measure</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;html_distance&#39;</span><span class="p">,</span>
                                    <span class="n">visit_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
                                    <span class="n">excluded_url_terms</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                                    <span class="n">required_keywords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">excluded_keywords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                    <span class="n">ignore_urls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">ignore_domains</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                                    <span class="n">be_polite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                    <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs web crawl from seed URL or URls, then runs a comparative analysis on results.  Compares every combination of site crawled. </span>
<span class="sd">    </span>
<span class="sd">    WARNING: can be slow if crawl is large.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    seed_urls : str or list </span>
<span class="sd">        one or more URLs from which to crawl.</span>
<span class="sd">    visit_limit : int </span>
<span class="sd">        how many URLs the crawler should visit before it stops.</span>
<span class="sd">    excluded_url_terms : list </span>
<span class="sd">        list of strings; link will be ignored if it contains any string in list.</span>
<span class="sd">    required_keywords : list </span>
<span class="sd">        list of keywords which sites must contain to be crawled.</span>
<span class="sd">    excluded_keywords : list </span>
<span class="sd">        list of keywords which sites must *not* contain to be crawled.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether or not to ignore string characters&#39; case.</span>
<span class="sd">    ignore_urls : list </span>
<span class="sd">        list of URLs to ignore.</span>
<span class="sd">    ignore_domains : list </span>
<span class="sd">        list of domains to ignore.</span>
<span class="sd">    be_polite : bool </span>
<span class="sd">        whether respect websites&#39; permissions for crawlers.</span>
<span class="sd">    full : bool </span>
<span class="sd">        whether to run a full scrape on each site. This takes longer.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    output_df : pandas.DataFrame</span>
<span class="sd">        dataframe of comparisons.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">        * title_distance : float Levenshtein distance between titles (0 if identical).</span>
<span class="sd">        * author_distance : float Levenshtein distance between author names (0 if identical).</span>
<span class="sd">        * hostname_distance : float Levenshtein distance between hostnames (0 if identical).</span>
<span class="sd">        * same_domain : bool whether sites share the same domain (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * shared_links : set links shared by both sites.</span>
<span class="sd">        * date_difference (timedelta): time difference between site date entries.</span>
<span class="sd">        * same_language : bool whether sites share the same language (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * fingerprint_distance : float Levenshtein distance between site fingerprints (0 if identical).</span>
<span class="sd">        * id_distance : float Levenshtein distance between site IDs (0 if identical).</span>
<span class="sd">        * license_distance : float Levenshtein distance between licenses (0 if identical).</span>
<span class="sd">        * comments_distance : float Levenshtein distance between comments (0 if identical).</span>
<span class="sd">        * raw_text_distance : float Levenshtein distance between raw texts (0 if identical).</span>
<span class="sd">        * raw_text_cosine : float Cosine similarity by word count of raw texts (1 if identical).</span>
<span class="sd">        * text_distance : float Levenshtein distance between parsed texts (0 if identical).</span>
<span class="sd">        * text_cosine : float Cosine similarity by word count of parsed texts (1 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source names (0 if identical).</span>
<span class="sd">        * source-hostname_distance : float Levenshtein distance between source-hostname names (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * excerpt_distance : float Levenshtein distance between excerpts (0 if identical).</span>
<span class="sd">        * excerpt_cosine : float Cosine similarity by word count of excerpts (1 if identical).</span>
<span class="sd">        * shared_categories : set category tags shared by both sites.</span>
<span class="sd">        * shared_tags : set tags shared by both sites.</span>
<span class="sd">        * html_distance : float Levenshtein distance between HTML source codes (0 if identical).</span>
<span class="sd">        * description_distance : float Levenshtein distance between descriptions (0 if identical).</span>
<span class="sd">        * description_cosine : float Cosine similarity by word count of descriptions (1 if identical).</span>
<span class="sd">        * sitename_distance : float Levenshtein distance between sitenames (0 if identical).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">crawl_result</span> <span class="o">=</span> <span class="n">crawler</span><span class="p">(</span>
                                    <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">seed_urls</span><span class="p">,</span>
                                    <span class="n">visit_limit</span> <span class="o">=</span> <span class="n">visit_limit</span><span class="p">,</span> 
                                    <span class="n">excluded_url_terms</span> <span class="o">=</span> <span class="n">excluded_url_terms</span><span class="p">,</span>
                                    <span class="n">required_keywords</span> <span class="o">=</span> <span class="n">required_keywords</span><span class="p">,</span> 
                                    <span class="n">excluded_keywords</span> <span class="o">=</span> <span class="n">excluded_keywords</span><span class="p">,</span> 
                                    <span class="n">case_sensitive</span> <span class="o">=</span> <span class="n">case_sensitive</span><span class="p">,</span>
                                    <span class="n">ignore_urls</span> <span class="o">=</span> <span class="n">ignore_urls</span><span class="p">,</span> 
                                    <span class="n">ignore_domains</span> <span class="o">=</span> <span class="n">ignore_domains</span><span class="p">,</span>
                                    <span class="n">be_polite</span> <span class="o">=</span> <span class="n">be_polite</span><span class="p">,</span>
                                    <span class="n">full</span> <span class="o">=</span> <span class="n">full</span><span class="p">,</span>
                                    <span class="n">output_as</span> <span class="o">=</span> <span class="s1">&#39;dataframe&#39;</span>
                                <span class="p">)</span>
    
    <span class="n">comparisons_df</span> <span class="o">=</span> <span class="n">compare_sites</span><span class="p">(</span><span class="n">crawl_result</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">comparisons_df</span></div>

<div class="viewcode-block" id="site_similarity_network"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.site_similarity_network">[docs]</a><span class="k">def</span> <span class="nf">site_similarity_network</span><span class="p">(</span><span class="n">comparisons_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">measure</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;html_distance&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Graph</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes site comparison result and returns a weighted network.</span>
<span class="sd">    </span>
<span class="sd">    Crawled URLs become vertices; similarity measures between URLs become undirected edges.</span>
<span class="sd">    Edge weights correspond to a chosen similarity measure.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    comparisons_df : pandas.DataFrame </span>
<span class="sd">        site comparison result to be converted to network.</span>
<span class="sd">    measure : str </span>
<span class="sd">        similarity measure to use as edge weight.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    network : igraph.Graph </span>
<span class="sd">        a weighted, undirected, complete network representing the site comparisons.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Options for &#39;measure&#39; (defaults to &#39;html_distance&#39;):</span>
<span class="sd">        * title_distance : float Levenshtein distance between titles (0 if identical).</span>
<span class="sd">        * author_distance : float Levenshtein distance between author names (0 if identical).</span>
<span class="sd">        * hostname_distance : float Levenshtein distance between hostnames (0 if identical).</span>
<span class="sd">        * same_domain : bool whether sites share the same domain (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * shared_links : set links shared by both sites.</span>
<span class="sd">        * date_difference (timedelta): time difference between site date entries.</span>
<span class="sd">        * same_language : bool whether sites share the same language (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * fingerprint_distance : float Levenshtein distance between site fingerprints (0 if identical).</span>
<span class="sd">        * id_distance : float Levenshtein distance between site IDs (0 if identical).</span>
<span class="sd">        * license_distance : float Levenshtein distance between licenses (0 if identical).</span>
<span class="sd">        * comments_distance : float Levenshtein distance between comments (0 if identical).</span>
<span class="sd">        * raw_text_distance : float Levenshtein distance between raw texts (0 if identical).</span>
<span class="sd">        * raw_text_cosine : float Cosine similarity by word count of raw texts (1 if identical).</span>
<span class="sd">        * text_distance : float Levenshtein distance between parsed texts (0 if identical).</span>
<span class="sd">        * text_cosine : float Cosine similarity by word count of parsed texts (1 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source names (0 if identical).</span>
<span class="sd">        * source-hostname_distance : float Levenshtein distance between source-hostname names (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * excerpt_distance : float Levenshtein distance between excerpts (0 if identical).</span>
<span class="sd">        * excerpt_cosine : float Cosine similarity by word count of excerpts (1 if identical).</span>
<span class="sd">        * shared_categories : set category tags shared by both sites.</span>
<span class="sd">        * shared_tags : set tags shared by both sites.</span>
<span class="sd">        * html_distance : float Levenshtein distance between HTML source codes (0 if identical).</span>
<span class="sd">        * description_distance : float Levenshtein distance between descriptions (0 if identical).</span>
<span class="sd">        * description_cosine : float Cosine similarity by word count of descriptions (1 if identical).</span>
<span class="sd">        * sitename_distance : float Levenshtein distance between sitenames (0 if identical).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Retrieving pairs of URLs from comparisons result</span>
    <span class="n">tuples</span> <span class="o">=</span> <span class="n">comparisons_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    
    <span class="c1"># Reformatting dataframe.</span>
    <span class="n">comparisons_df</span> <span class="o">=</span> <span class="n">comparisons_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="c1"># Building tuple of URLs</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">:</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="n">urls</span> <span class="o">+</span> <span class="n">pair</span>
    
    <span class="c1"># Converting tuple of tuples into a list of URls with repeats removed</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">urls</span><span class="p">))</span>
    
    <span class="c1"># Getting number of URLs</span>
    <span class="n">vs_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>
    
    <span class="c1"># Initialising full network</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">Graph</span><span class="o">.</span><span class="n">Full</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">vs_n</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># Assigning URL metadata as vertex attributes</span>
    <span class="n">network</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">urls</span>
    <span class="n">network</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;website&#39;</span>
    
    
    <span class="c1"># Iterating through edges</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">es</span><span class="p">:</span>
        
        <span class="c1"># Retrieving edge&#39;s source vertex ID and name</span>
        <span class="n">source_id</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">source</span>
        <span class="n">source_name</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">source_id</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        
        <span class="c1"># Retrieving edge&#39;s source vertex ID and name</span>
        <span class="n">target_id</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span>
        <span class="n">target_name</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">target_id</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        
        <span class="c1"># Creating tuple of names to use to mask dataframe</span>
        <span class="n">tuple_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">source_name</span><span class="p">,</span> <span class="n">target_name</span><span class="p">)</span>
        <span class="n">tuple_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="n">source_name</span><span class="p">)</span>
        
        <span class="c1"># Masking dataframe to extract data from selected column</span>
        <span class="n">comparisons_masked</span> <span class="o">=</span> <span class="n">comparisons_df</span><span class="p">[(</span><span class="n">comparisons_df</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tuple_1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">comparisons_df</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tuple_2</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">comparisons_masked</span><span class="p">[</span><span class="n">measure</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
        <span class="n">e</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
        
        <span class="c1"># Assigning comparison results as edge attributes</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">comparisons_masked</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">e</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">comparisons_masked</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">network</span></div>
    

<div class="viewcode-block" id="similarity_network_from_crawl_result"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.similarity_network_from_crawl_result">[docs]</a><span class="k">def</span> <span class="nf">similarity_network_from_crawl_result</span><span class="p">(</span><span class="n">crawl_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">measure</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;html_distance&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Graph</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes web crawl result, compares sites found, and returns a weighted network representing those sites&#39; similarities.</span>
<span class="sd">    </span>
<span class="sd">    Crawled URLs become vertices; similarity measures between URLs become undirected edges.</span>
<span class="sd">    Edge weights correspond to a chosen similarity measure.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    crawl_df : pandas.DataFrame</span>
<span class="sd">        web crawl result.</span>
<span class="sd">    measure : str</span>
<span class="sd">        similarity measure to use as edge weight.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    network : igraph.Graph </span>
<span class="sd">        a weighted, undirected, complete network representing the site comparisons.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Options for &#39;measure&#39; (defaults to &#39;html_distance&#39;):</span>
<span class="sd">        * title_distance : float Levenshtein distance between titles (0 if identical).</span>
<span class="sd">        * author_distance : float Levenshtein distance between author names (0 if identical).</span>
<span class="sd">        * hostname_distance : float Levenshtein distance between hostnames (0 if identical).</span>
<span class="sd">        * same_domain : bool whether sites share the same domain (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * shared_links : set links shared by both sites.</span>
<span class="sd">        * date_difference (timedelta): time difference between site date entries.</span>
<span class="sd">        * same_language : bool whether sites share the same language (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * fingerprint_distance : float Levenshtein distance between site fingerprints (0 if identical).</span>
<span class="sd">        * id_distance : float Levenshtein distance between site IDs (0 if identical).</span>
<span class="sd">        * license_distance : float Levenshtein distance between licenses (0 if identical).</span>
<span class="sd">        * comments_distance : float Levenshtein distance between comments (0 if identical).</span>
<span class="sd">        * raw_text_distance : float Levenshtein distance between raw texts (0 if identical).</span>
<span class="sd">        * raw_text_cosine : float Cosine similarity by word count of raw texts (1 if identical).</span>
<span class="sd">        * text_distance : float Levenshtein distance between parsed texts (0 if identical).</span>
<span class="sd">        * text_cosine : float Cosine similarity by word count of parsed texts (1 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source names (0 if identical).</span>
<span class="sd">        * source-hostname_distance : float Levenshtein distance between source-hostname names (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * excerpt_distance : float Levenshtein distance between excerpts (0 if identical).</span>
<span class="sd">        * excerpt_cosine : float Cosine similarity by word count of excerpts (1 if identical).</span>
<span class="sd">        * shared_categories : set category tags shared by both sites.</span>
<span class="sd">        * shared_tags : set tags shared by both sites.</span>
<span class="sd">        * html_distance : float Levenshtein distance between HTML source codes (0 if identical).</span>
<span class="sd">        * description_distance : float Levenshtein distance between descriptions (0 if identical).</span>
<span class="sd">        * description_cosine : float Cosine similarity by word count of descriptions (1 if identical).</span>
<span class="sd">        * sitename_distance : float Levenshtein distance between sitenames (0 if identical).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Running site comparisons</span>
    <span class="n">comparisons_df</span> <span class="o">=</span> <span class="n">compare_sites</span><span class="p">(</span><span class="n">crawl_df</span><span class="p">)</span>
    
    <span class="c1"># Generating network</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">site_similarity_network</span><span class="p">(</span><span class="n">comparisons_df</span><span class="p">,</span> <span class="n">measure</span> <span class="o">=</span> <span class="n">measure</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">network</span></div>

<div class="viewcode-block" id="similarity_network_from_crawl"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.similarity_network_from_crawl">[docs]</a><span class="k">def</span> <span class="nf">similarity_network_from_crawl</span><span class="p">(</span>
                                <span class="n">seed_urls</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">,</span>
                                <span class="n">measure</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;html_distance&#39;</span><span class="p">,</span>
                                <span class="n">visit_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
                                <span class="n">excluded_url_terms</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                                <span class="n">required_keywords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                <span class="n">excluded_keywords</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="n">ignore_urls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                <span class="n">ignore_domains</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                                <span class="n">be_polite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Graph</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs web crawl, compares sites found, and returns a weighted network representing those sites&#39; similarities.</span>
<span class="sd">    </span>
<span class="sd">    Crawled URLs become vertices; similarity measures between URLs become undirected edges.</span>
<span class="sd">    Edge weights correspond to a chosen similarity measure.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    seed_urls : str or list </span>
<span class="sd">        one or more URLs from which to crawl.</span>
<span class="sd">    measure : str </span>
<span class="sd">        similarity measure to use as edge weight.</span>
<span class="sd">    visit_limit : int </span>
<span class="sd">        how many URLs the crawler should visit before it stops.</span>
<span class="sd">    excluded_url_terms : list </span>
<span class="sd">        list of strings; link will be ignored if it contains any string in list.</span>
<span class="sd">    required_keywords : list </span>
<span class="sd">        list of keywords which sites must contain to be crawled.</span>
<span class="sd">    excluded_keywords : list </span>
<span class="sd">        list of keywords which sites must *not* contain to be crawled.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether or not to ignore string characters&#39; case.</span>
<span class="sd">    ignore_urls : list </span>
<span class="sd">        list of URLs to ignore.</span>
<span class="sd">    ignore_domains : list </span>
<span class="sd">        list of domains to ignore.</span>
<span class="sd">    be_polite : bool </span>
<span class="sd">        whether respect websites&#39; permissions for crawlers.</span>
<span class="sd">    full : bool </span>
<span class="sd">        whether to run a full scrape on each site. This takes longer.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    network : igraph.Graph </span>
<span class="sd">        a weighted, undirected, complete network representing the site comparisons.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Options for &#39;measure&#39; (defaults to &#39;html_distance&#39;):</span>
<span class="sd">        * title_distance : float Levenshtein distance between titles (0 if identical).</span>
<span class="sd">        * author_distance : float Levenshtein distance between author names (0 if identical).</span>
<span class="sd">        * hostname_distance : float Levenshtein distance between hostnames (0 if identical).</span>
<span class="sd">        * same_domain : bool whether sites share the same domain (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * shared_links : set links shared by both sites.</span>
<span class="sd">        * date_difference (timedelta): time difference between site date entries.</span>
<span class="sd">        * same_language : bool whether sites share the same language (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * fingerprint_distance : float Levenshtein distance between site fingerprints (0 if identical).</span>
<span class="sd">        * id_distance : float Levenshtein distance between site IDs (0 if identical).</span>
<span class="sd">        * license_distance : float Levenshtein distance between licenses (0 if identical).</span>
<span class="sd">        * comments_distance : float Levenshtein distance between comments (0 if identical).</span>
<span class="sd">        * raw_text_distance : float Levenshtein distance between raw texts (0 if identical).</span>
<span class="sd">        * raw_text_cosine : float Cosine similarity by word count of raw texts (1 if identical).</span>
<span class="sd">        * text_distance : float Levenshtein distance between parsed texts (0 if identical).</span>
<span class="sd">        * text_cosine : float Cosine similarity by word count of parsed texts (1 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source names (0 if identical).</span>
<span class="sd">        * source-hostname_distance : float Levenshtein distance between source-hostname names (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * excerpt_distance : float Levenshtein distance between excerpts (0 if identical).</span>
<span class="sd">        * excerpt_cosine : float Cosine similarity by word count of excerpts (1 if identical).</span>
<span class="sd">        * shared_categories : set category tags shared by both sites.</span>
<span class="sd">        * shared_tags : set tags shared by both sites.</span>
<span class="sd">        * html_distance : float Levenshtein distance between HTML source codes (0 if identical).</span>
<span class="sd">        * description_distance : float Levenshtein distance between descriptions (0 if identical).</span>
<span class="sd">        * description_cosine : float Cosine similarity by word count of descriptions (1 if identical).</span>
<span class="sd">        * sitename_distance : float Levenshtein distance between sitenames (0 if identical).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Running web crawl</span>
    <span class="n">crawl_result</span> <span class="o">=</span> <span class="n">crawler</span><span class="p">(</span>
                            <span class="n">seed_urls</span> <span class="o">=</span> <span class="n">seed_urls</span><span class="p">,</span>
                            <span class="n">visit_limit</span> <span class="o">=</span> <span class="n">visit_limit</span><span class="p">,</span> 
                            <span class="n">excluded_url_terms</span> <span class="o">=</span> <span class="n">excluded_url_terms</span><span class="p">,</span>
                            <span class="n">required_keywords</span> <span class="o">=</span> <span class="n">required_keywords</span><span class="p">,</span> 
                            <span class="n">excluded_keywords</span> <span class="o">=</span> <span class="n">excluded_keywords</span><span class="p">,</span> 
                            <span class="n">case_sensitive</span> <span class="o">=</span> <span class="n">case_sensitive</span><span class="p">,</span>
                            <span class="n">ignore_urls</span> <span class="o">=</span> <span class="n">ignore_urls</span><span class="p">,</span> 
                            <span class="n">ignore_domains</span> <span class="o">=</span> <span class="n">ignore_domains</span><span class="p">,</span>
                            <span class="n">be_polite</span> <span class="o">=</span> <span class="n">be_polite</span><span class="p">,</span>
                            <span class="n">full</span> <span class="o">=</span> <span class="n">full</span><span class="p">,</span>
                            <span class="n">output_as</span> <span class="o">=</span> <span class="s1">&#39;dataframe&#39;</span><span class="p">)</span>
        
    
    <span class="c1"># Running site comparisons and generating network</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">similarity_network_from_crawl_result</span><span class="p">(</span><span class="n">crawl_result</span><span class="p">,</span> <span class="n">measure</span> <span class="o">=</span> <span class="n">measure</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">network</span></div>
    

<div class="viewcode-block" id="network_from_search_crawl"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.network_from_search_crawl">[docs]</a><span class="k">def</span> <span class="nf">network_from_search_crawl</span><span class="p">(</span>
                            <span class="n">query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">,</span>
                            <span class="n">visit_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
                            <span class="n">excluded_url_terms</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                            <span class="n">required_keywords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">excluded_keywords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">ignore_urls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">ignore_domains</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                            <span class="n">be_polite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">output_as</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;dataframe&#39;</span>
                            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Graph</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs web crawl from search and generates a directed network from the results.</span>
<span class="sd">    </span>
<span class="sd">    Crawled URLs become vertices; links between URLS become directed edges.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    query : str </span>
<span class="sd">        query to search.</span>
<span class="sd">    visit_limit : int </span>
<span class="sd">        how many URLs the crawler should visit before it stops.</span>
<span class="sd">    excluded_url_terms : list </span>
<span class="sd">        list of strings; link will be ignored if it contains any string in list.</span>
<span class="sd">    required_keywords : list </span>
<span class="sd">        list of keywords which sites must contain to be crawled.</span>
<span class="sd">    excluded_keywords : list </span>
<span class="sd">        list of keywords which sites must *not* contain to be crawled.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether or not to ignore string characters&#39; case.</span>
<span class="sd">    ignore_urls : list </span>
<span class="sd">        list of URLs to ignore.</span>
<span class="sd">    ignore_domains : list </span>
<span class="sd">        list of domains to ignore.</span>
<span class="sd">    be_polite : bool </span>
<span class="sd">        whether respect websites&#39; permissions for crawlers.</span>
<span class="sd">    full : bool </span>
<span class="sd">        whether to run a full scrape on each site. This takes longer.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    network : igraph.Graph </span>
<span class="sd">        a network representing the results of a web crawl.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">crawl_result</span> <span class="o">=</span> <span class="n">crawl_from_search</span><span class="p">(</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">,</span>
            <span class="n">visit_limit</span> <span class="o">=</span> <span class="n">visit_limit</span><span class="p">,</span> 
            <span class="n">excluded_url_terms</span> <span class="o">=</span> <span class="n">excluded_url_terms</span><span class="p">,</span>
            <span class="n">required_keywords</span> <span class="o">=</span> <span class="n">required_keywords</span><span class="p">,</span> 
            <span class="n">excluded_keywords</span> <span class="o">=</span> <span class="n">excluded_keywords</span><span class="p">,</span> 
            <span class="n">case_sensitive</span> <span class="o">=</span> <span class="n">case_sensitive</span><span class="p">,</span>
            <span class="n">ignore_urls</span> <span class="o">=</span> <span class="n">ignore_urls</span><span class="p">,</span> 
            <span class="n">ignore_domains</span> <span class="o">=</span> <span class="n">ignore_domains</span><span class="p">,</span>
            <span class="n">be_polite</span> <span class="o">=</span> <span class="n">be_polite</span><span class="p">,</span>
            <span class="n">full</span> <span class="o">=</span> <span class="n">full</span><span class="p">,</span>
            <span class="n">output_as</span> <span class="o">=</span> <span class="s1">&#39;dataframe&#39;</span>
            <span class="p">)</span>
    
    <span class="n">network</span> <span class="o">=</span> <span class="n">network_from_crawl_result</span><span class="p">(</span><span class="n">crawl_result</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">network</span></div>
    
    

<div class="viewcode-block" id="similarity_network_from_search_crawl"><a class="viewcode-back" href="../../../ida.internet.html#ida.internet.crawlers.similarity_network_from_search_crawl">[docs]</a><span class="k">def</span> <span class="nf">similarity_network_from_search_crawl</span><span class="p">(</span>
                            <span class="n">query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;request_input&#39;</span><span class="p">,</span>
                            <span class="n">measure</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;html_distance&#39;</span><span class="p">,</span>
                            <span class="n">visit_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
                            <span class="n">excluded_url_terms</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                            <span class="n">required_keywords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">excluded_keywords</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">ignore_urls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">ignore_domains</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                            <span class="n">be_polite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">output_as</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;dataframe&#39;</span>
                            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Graph</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs web crawl from search, compares sites that are found, and generates an undirected network from the results.</span>
<span class="sd">    </span>
<span class="sd">    Crawled URLs become vertices; similarity measures between URLs become undirected edges.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------- </span>
<span class="sd">    query : str </span>
<span class="sd">        query to search.</span>
<span class="sd">    measure : str </span>
<span class="sd">        similarity measure to use as edge weight.</span>
<span class="sd">    visit_limit : int </span>
<span class="sd">        how many URLs the crawler should visit before it stops.</span>
<span class="sd">    excluded_url_terms : list </span>
<span class="sd">        list of strings; link will be ignored if it contains any string in list.</span>
<span class="sd">    required_keywords : list </span>
<span class="sd">        list of keywords which sites must contain to be crawled.</span>
<span class="sd">    excluded_keywords : list </span>
<span class="sd">        list of keywords which sites must *not* contain to be crawled.</span>
<span class="sd">    case_sensitive : bool </span>
<span class="sd">        whether or not to ignore string characters&#39; case.</span>
<span class="sd">    ignore_urls : list </span>
<span class="sd">        list of URLs to ignore.</span>
<span class="sd">    ignore_domains : list list of domains to ignore.</span>
<span class="sd">    be_polite : bool </span>
<span class="sd">        whether respect websites&#39; permissions for crawlers.</span>
<span class="sd">    full : bool </span>
<span class="sd">        whether to run a full scrape on each site. This takes longer.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    network : igraph.Graph </span>
<span class="sd">        a network representing the results of site comparison analysis.</span>
<span class="sd">        </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Options for &#39;measure&#39; (defaults to &#39;html_distance&#39;):</span>
<span class="sd">        * title_distance : float Levenshtein distance between titles (0 if identical).</span>
<span class="sd">        * author_distance : float Levenshtein distance between author names (0 if identical).</span>
<span class="sd">        * hostname_distance : float Levenshtein distance between hostnames (0 if identical).</span>
<span class="sd">        * same_domain : bool whether sites share the same domain (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * shared_links : set links shared by both sites.</span>
<span class="sd">        * date_difference (timedelta): time difference between site date entries.</span>
<span class="sd">        * same_language : bool whether sites share the same language (True/False).</span>
<span class="sd">        * domain_distance : float Levenshtein distance between domains (0 if identical).</span>
<span class="sd">        * fingerprint_distance : float Levenshtein distance between site fingerprints (0 if identical).</span>
<span class="sd">        * id_distance : float Levenshtein distance between site IDs (0 if identical).</span>
<span class="sd">        * license_distance : float Levenshtein distance between licenses (0 if identical).</span>
<span class="sd">        * comments_distance : float Levenshtein distance between comments (0 if identical).</span>
<span class="sd">        * raw_text_distance : float Levenshtein distance between raw texts (0 if identical).</span>
<span class="sd">        * raw_text_cosine : float Cosine similarity by word count of raw texts (1 if identical).</span>
<span class="sd">        * text_distance : float Levenshtein distance between parsed texts (0 if identical).</span>
<span class="sd">        * text_cosine : float Cosine similarity by word count of parsed texts (1 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source names (0 if identical).</span>
<span class="sd">        * source-hostname_distance : float Levenshtein distance between source-hostname names (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * source_distance : float Levenshtein distance between source code (0 if identical).</span>
<span class="sd">        * excerpt_distance : float Levenshtein distance between excerpts (0 if identical).</span>
<span class="sd">        * excerpt_cosine : float Cosine similarity by word count of excerpts (1 if identical).</span>
<span class="sd">        * shared_categories : set category tags shared by both sites.</span>
<span class="sd">        * shared_tags : set tags shared by both sites.</span>
<span class="sd">        * html_distance : float Levenshtein distance between HTML source codes (0 if identical).</span>
<span class="sd">        * description_distance : float Levenshtein distance between descriptions (0 if identical).</span>
<span class="sd">        * description_cosine : float Cosine similarity by word count of descriptions (1 if identical).</span>
<span class="sd">        * sitename_distance : float Levenshtein distance between sitenames (0 if identical).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">crawl_result</span> <span class="o">=</span> <span class="n">crawl_from_search</span><span class="p">(</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">,</span>
            <span class="n">visit_limit</span> <span class="o">=</span> <span class="n">visit_limit</span><span class="p">,</span> 
            <span class="n">excluded_url_terms</span> <span class="o">=</span> <span class="n">excluded_url_terms</span><span class="p">,</span>
            <span class="n">required_keywords</span> <span class="o">=</span> <span class="n">required_keywords</span><span class="p">,</span> 
            <span class="n">excluded_keywords</span> <span class="o">=</span> <span class="n">excluded_keywords</span><span class="p">,</span> 
            <span class="n">case_sensitive</span> <span class="o">=</span> <span class="n">case_sensitive</span><span class="p">,</span>
            <span class="n">ignore_urls</span> <span class="o">=</span> <span class="n">ignore_urls</span><span class="p">,</span> 
            <span class="n">ignore_domains</span> <span class="o">=</span> <span class="n">ignore_domains</span><span class="p">,</span>
            <span class="n">be_polite</span> <span class="o">=</span> <span class="n">be_polite</span><span class="p">,</span>
            <span class="n">full</span> <span class="o">=</span> <span class="n">full</span><span class="p">,</span>
            <span class="n">output_as</span> <span class="o">=</span> <span class="s1">&#39;dataframe&#39;</span>
            <span class="p">)</span>
    
    <span class="n">network</span> <span class="o">=</span> <span class="n">similarity_network_from_crawl_result</span><span class="p">(</span><span class="n">crawl_result</span> <span class="o">=</span> <span class="n">crawl_result</span><span class="p">,</span> <span class="n">measure</span> <span class="o">=</span> <span class="n">measure</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">network</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Jamie Hancock.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>